drop database sales;

create database sales;

use sales;

CREATE TABLE customers(
	CUST_ID VARCHAR(8) PRIMARY KEY,
 	PWD VARCHAR(8) CHECK(LEN(PWD) >= 4), 
	EMAIL VARCHAR(24) NOT NULL,
	CREDIT NUMERIC(8,2) CHECK(CREDIT >= 0));

CREATE TABLE products(
	PNO INT  PRIMARY KEY, 
	PRICE NUMERIC(8,2) NOT NULL,
	STOCK INT CHECK(STOCK >= 0));

CREATE TABLE orders(
	ORD_NO INT PRIMARY KEY, 
	ORD_DATE DATETIME, 
	CUST_ID VARCHAR(8) REFERENCES customers(CUST_ID), 
	PNO INT REFERENCES products(PNO), 
	QTY INT CHECK(QTY > 0));

CREATE TABLE ord_ctl(
	CUST_ID INT, 
	PNO INT, 
	ORD_NO INT);


INSERT INTO customers VALUES ('CU101', 'PW101', 'JOHN@DOE.COM', 5000);

INSERT INTO customers VALUES ('CU102', 'PW102', 'JILL@SMITH.NET', 6000);

INSERT INTO customers VALUES ('CU103', 'PW103', 'JACK@SMITH.NET', 7000);

INSERT INTO customers VALUES ('CU104', 'PW104', 'JANE@DOE.COM', 8000);

INSERT INTO products VALUES (101, 350, 10);

INSERT INTO products VALUES (102, 975, 20);

INSERT INTO products VALUES (103, 845,30);

INSERT INTO products VALUES (104, 1025, 40);

INSERT INTO products VALUES (105, 700, 50);

INSERT INTO orders VALUES(1001, '2001-01-12', 'CU102', 101, 5);

INSERT INTO orders VALUES(1002, '2001-01-25', 'CU103', 102, 10);

INSERT INTO orders VALUES(1003, '2001-02-08', 'CU102', 102, 12);

INSERT INTO orders VALUES(1004, '2001-03-21', 'CU101', 103, 3);

INSERT INTO orders VALUES(1005, '2001-03-19', 'CU103', 104, 15);

INSERT INTO orders VALUES(1006, '2001-04-11', 'CU104', 105, 12);


INSERT INTO ord_ctl VALUES(104, 105, 1006);



CREATE VIEW ord_view AS 
    SELECT ORD_NO, ORD_DATE, CUST_ID, orders.PNO, QTY, PRICE*QTY AS AMT 
    FROM orders, products 
    WHERE orders.PNO = products.PNO;

